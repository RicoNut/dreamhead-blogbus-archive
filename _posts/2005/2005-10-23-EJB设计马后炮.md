---
layout: post
title: EJB设计马后炮
author: dreamhead
date: 2005-10-23 23:33:00 +0800
tags: [  ]
categories: [  ]
---

Tag: 向上走 在without EJB之后，EJB在开明人士的眼中已经快成了人人喊打的过街老鼠。我不妨也干一回落井下石的事，从设计的角度，品评一下EJB。鉴于without EJB嘹亮的声音，这篇blog也算是一篇读后感，故称马后炮。 谈到设计，最先在头脑中出现的Robert Martin的《敏捷软件开发》，这本Jolt大奖作品应该是给我冲击最大的几本书之一，它为我打开软件设计的大门，对我而言，它最有价值的部分并不在于设计模式，而在于设计原则。相对于设计模式而言，设计原则是一些meta的知识，掌握了设计原则，理解模式也就是很自然的事情了。 提起EJB，人们首先会想到它叫得最凶的组件的概念。在经典的J2EE架构中，EJB往往是单独部署在一台应用服务器上，所以，谈及EJB，它的远程访问也是必不可少的。我就曾经设计过一个EJB，目的只是为了使用它的远程模型，省却自行开发通信协议的烦恼。既要承担业务组件的职责，又要扛起远程通信的大旗，EJB在这一点上很显然是一个部分承担了多个职责，这显然是违反单一职责原则的。或许你编写EJB只是作为一个业务组件，但你不能说我用它做远程通信就是错的，尽管这不是什么标准做法，谁让EJB这么能干呢！其实，为了讨论方便，我还少提了一点，EJB往往还有线程模型在其中，这只是让它能干的事更多，进一步违反单一职责的纪律而已。 “声明性”为简化程序结构提供了一条金光大道，只要你做好自己该做的事情，一些额外的服务可以通过声明附加进去，让程序的威力得到加强。EJB在这方面做了一些事情，提供了包括事务管理、线程管理和安全性在内的一些常用服务。但是，这些服务远不足以满足人们日益增长的物质文化需要。当你冀望于按照自己的想法增加一些服务时，你才会发现，报国无门啊！EJB很好的做到不必修改，但其不能扩展的实际情况实在有愧于框架的美誉。这显然是违反了开放—封闭原则。 在这个敏捷横行年代，如果做设计的时候不考虑测试的问题，那这个设计师一定会被视为老古董，因为他连测试优先都不知道。测试驱动开发的“开发”可不只是编码，那是要从软件开发的源头算起的“开发”，身在开发过程之中的设计自己也不能免俗了。如果你像我一样经历过在应用服务器上调试一个bug，你就知道我为什么心甘情愿地奔向测试驱动开发的怀抱，那是一段让人不堪回首的往事，本来三两分钟就可以搞定的问题，耗去了两个小时。而这一切的一切，起因就是EJB。 考虑EJB问世时，敏捷尚未成风，我们还可以原谅它对于可测试性缺乏思考，那么违反单一职责原则和开放—封闭原则实在是制订标准的人对于这个问题思考不足，想来设计这些东西的人也并非等闲之辈，由此我只能得出一个结论：官僚主义害死人的。


