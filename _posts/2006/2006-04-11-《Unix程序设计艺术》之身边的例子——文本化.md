---
layout: post
title: 《Unix程序设计艺术》之身边的例子——文本化
author: dreamhead
date: 2006-04-11 22:07:00 +0800
tags: [  ]
categories: [  ]
---

《Unix程序设计艺术》是一本讲解Unix文化的书。作者——开源运动的发起者Eric Raymond将多年沉浸于Unix经验一一道出，对于后来者理解程序设计中一些不变的东西大有裨益。该书的第二部分讲解Unix程序在设计上的一些考虑。在我看来，这里所讲的一些设计原则，更多是站在程序的外部进行观察，比如建议程序与外部接口文本化，比如将程序的内部信息以恰当的形式暴露出来以便外部观察等等。 这本书的第五章讨论的是文本化，也就是以文本作为存储或传输的格式。 在我的编程经历中，很早就开始同文本格式打交道。我参与的第一个Java应用，其协议采用了SOAP，也就是XML，也就是文本格式。在随后的几年中，我一直在与XML为伍，无论是配置文件，还是传输协议，所以，文本格式在我心中成了一种理所当然的选择。记得有段时间在一个实验室测试，当时的目的就是在测协议接口，大家经常干的一件事，就是把接收或发送的包打印在屏幕上，以便快速发现问题。幸运的就是我们的传输协议是文本格式，所以，我们省去了开发额外工具或是数字节的困扰。别以为这是开玩笑，那时候，部门的另外一个项目组在同一个楼和我们一同做着测试，他们的协议是二进制的。每次看到他们一个一个数字节，我心存恐惧的同时暗自窃喜着。 那个系统分为业务系统和管理系统两个部分，为了让二者关联起来，我们需要开发了一个通信协议。就在我们几个人在外测试的阶段，我们一个很勤快的同事把这个部分开发出来，他采用了Java的序列化作为通信协议。当他离开部门之后，我们试图修改这个部分，发现这个部分已非我们能力所能控制。一方面，他的代码给人一种满天遍野的感觉，另一方面，任何对于服务器端的修改，必须要同时修改客户端，因为传输的是二进制，所以，如果不同时对两端进行修改，我们无法保证通信的正确。原本独立发展的两端不明不白的给连接到了一起。 最近的一个关于文本化的例子来自于我现在开发的算法中的持久化部分。在最初的Matlab版本中，我采用了文本作为存储格式，到了C移植的时候，负责移植的同事原本的想法是偷了个懒，存成二进制格式，这样一条记录一下子就写进去了，读也是。事实证明，他懒惰的目的完全没有达到，一个小错误就够他忙活上半天，因为不直观，他又也要数字节才知道问题所在。一而再，再而三，他决定放弃了，对我说，看来选择文本方式存储是个好主意。 选择文本格式，对开发人员来说，是一种享受。


