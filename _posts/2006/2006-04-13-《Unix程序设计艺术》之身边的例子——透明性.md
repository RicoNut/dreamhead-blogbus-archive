---
layout: post
title: 《Unix程序设计艺术》之身边的例子——透明性
author: dreamhead
date: 2006-04-13 22:09:00 +0800
tags: [  ]
categories: [  ]
---

《Unix程序设计艺术》的第六章讨论的是透明性，站在开发人员的角度，我愿意把它理解为将程序内部的信息暴露出来，便于外部观察。 最初和暴露内部信息打交道是开发服务器端应用的那会儿。对于开发服务器端应用来说，很重要的一点就是要对程序的行为进行监控，所以，日志是个不二之选。在开发的最初阶段，程序极其不稳定，幸好我们有日志帮忙，把程序的运行状态一一记录下来。通过只要分析日志，我们基本上可以确定问题所在。后来即便程序上线运行，我们也没有把日志关掉，其目的当然是为了以防万一。事实也证明了这一点，每当客户向我们报告各种问题的时候，我们总是有据可查。 不过，这个日志也存在一个适量输出的问题。由于在开发的初期，我们没有对日志的使用方式进行严格的规范，所以，很多时候，本应是不同级别的日志都浮现出来，这边说“某某处理完毕”，那边说“某个变量等于多少”，看上去，爷爷孙子齐上阵，热闹归热闹，它也乱。对比一下Apache之类的服务器，它们日志很有规矩，正常情况下，没有多少东西，一旦出错，察看日志一般就可以看出问题所在。输出过多也多多少少会影响一些性能。当时部门另外一个项目组，他们的应用对于性能要求很高。在开发过程中使用日志，而在发布之前，要做一次统一清理，去掉不必要的日志，以免影响性能。 我现在的工作，暴露内部信息成了一种必须的选择。最初的研究过程，我们只是以简单识别率和误识别率来说事，当算法开发到一定程度，除了需要在宏观上进行分析，我们还需要对各个模块的表现进行分析，以防因为个别模块的问题造成整体指标下降。所以，在程序运行的过程中，我们需要将各个模块的输出结果也暴露出来，以便可以对各个模块进行评估。不过，由于最初的设计中，并没有将暴露内部信息的问题考虑进去，增加一个输出项就需要改一大片的代码，于是最近痛下决心，把代码清理了一下，至少现在增加输出的改动量要小了许多。 暴露算法内部信息的一个额外好处在于，我们可以开发相应的工具对结果进行分析。一方面，工具可以提高工作效率（现在评估一次的时间对比最初可是大大缩短）。另一方面，工具可以为我们做下一步行动提供了参考指南（原有算法中存在很多阈值，很大一部分源自大家的感觉，而非数据）。这一切都是算法透明性的功劳。 这个世界，透明点好！


